<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>狼人殺 Online</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    
    <style>
        body { font-family: sans-serif; padding: 20px; background: #222; color: #fff; }
        .container { max_width: 600px; margin: 0 auto; }
        .card { background: #333; padding: 20px; margin-bottom: 20px; border-radius: 8px; }
        input, button { padding: 10px; margin: 5px; width: 100%; box-sizing: border-box; }
        button { cursor: pointer; background: #555; color: white; border: none; font-weight: bold;}
        button:hover { background: #777; }
        .hidden { display: none; }
        .dead { text-decoration: line-through; color: #888; }
        #log-area { height: 200px; overflow-y: scroll; background: #000; padding: 10px; border: 1px solid #444; margin-bottom: 10px;}
        .setup-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .setup-row input { width: 50px; text-align: center; color: black;}
        .number-badge { background: #ff9800; color: black; border-radius: 50%; padding: 2px 8px; margin-right: 5px; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h1>🐺 狼人殺 Online</h1>

    <div id="login-view" class="card">
        <h3>加入房間</h3>
        <input type="text" id="username" placeholder="你的暱稱">
        <input type="text" id="room" placeholder="房間號碼 (101)" value="101">
        <button onclick="joinGame()" style="background: #1976d2;">加入大廳</button>

        <div style="margin-top: 20px; text-align: left; border-top: 1px solid #555; padding-top: 10px;">
            <details>
                <summary style="cursor: pointer; color: #ff9800; font-weight: bold;">📖 遊戲操作說明 (點我展開)</summary>
                <div style="font-size: 0.9em; color: #ccc; margin-top: 10px; line-height: 1.6;">
                    <p>1. <b>加入遊戲</b>：輸入暱稱與房號，房號相同即可一起遊玩。</p>
                    <p>2. <b>房主權限</b>：第一位進入房間的玩家為房主，可設定角色與開始遊戲。</p>
                    <p>3. <b>斷線重連</b>：若不小心關閉網頁或斷線，重新進入同房號並使用同暱稱即可自動恢復。</p>
                    <p>4. <b>投票與技能</b>：
                        <ul>
                            <li>點擊玩家頭像即可互動 (投票/殺人/查驗)。</li>
                            <li>女巫點擊解藥按鈕即可拯救狼人的目標對象。</li>
                            <li>女巫點擊毒藥按鈕，再點擊玩家頭像，即可毒殺選擇對象。</li>
                            <li>若女巫此夜不使用藥水，請點擊"結束我的回合"。</li>
                            <li>守衛點擊玩家頭像(空守)，即可守衛選擇對象。</li>
                            <li>狼人方可投票決定被殺對象，全部狼隊成員選擇同一對象時鎖定。
                                ※注意：若你為場上唯一狼，將沒有更換對象的權力，請做好決定再下手。</li>
                        </ul>
                    <p>5. <b>其他遊玩注意事項</b>：
                        <ul>
                            <li>投票完發表完遺言後(或全員棄票)請按"處決完成 -> 入夜"。</li>
                        </ul>
                    <div style="color: #f03426;">6. <b>⚠️出現任何bug導致無法繼續遊玩</b>：
                        <ul>
                            <li>請房主點擊"強制結束遊戲(重製)"按鈕。</li>
                            <li>若房間無法重製，請所有玩家點擊"離開房間"按鈕，並換房遊玩。</li>
                            <li>把產生的bug及遇到的狀況盡可能在 DC #狼人殺 頻道 詳細的描述(有辦法的話盡量附圖)。</li>
                        </ul>
                    </div>
                    <p style="color: #f88c00;">⚠️ 注意：手機遊玩請勿頻繁切換視窗，以免斷線。</p>
                </div>
            </details>
        </div>
    </div>

    <div id="lobby-view" class="card hidden">
        <h3>等待玩家加入...</h3>
        <ul id="player-list"></ul>
        <hr>
        
        <div id="host-settings" class="hidden">
            <h3>👑 房主設定</h3>
            <div class="setting-item">🐺 狼人：<input type="number" id="role-wolf" value="1" min="0"></div>
            <div class="setting-item">👑 狼王：<input type="number" id="role-wolfking" value="0" min="0"></div>
            <div class="setting-item">🔮 預言家：<input type="number" id="role-seer" value="1" min="0"></div>
            <div class="setting-item">🧪 女巫：<input type="number" id="role-witch" value="1" min="0"></div>
            <div class="setting-item">🛡️ 守衛：<input type="number" id="role-guard" value="0" min="0"></div>
            <div class="setting-item">🔫 獵人：<input type="number" id="role-hunter" value="0" min="0"></div>
            <div class="setting-item">村民：<input type="number" id="role-villager" value="3" min="0"></div>
            <div style="margin-top: 15px; display: flex; gap: 10px;">
                <button onclick="startGame()" style="flex: 2; background: #4caf50;">開始遊戲</button>
                <button onclick="resetGame()" style="flex: 1; background: #f44336;">🔄 重置</button>
            </div>
        </div>

        <div id="guest-waiting-msg" class="hidden">
            <h4 style="color: #ccc;">等待房主設定遊戲...</h4>
        </div>

        <div style="margin-top: 10px; border-top: 1px solid #555; padding-top: 10px;">
            <button onclick="logout()" style="background: #607d8b;">🚪 登出 / 切換名字</button>
        </div>
    </div>

    <div id="game-view" class="card hidden">
        <h2 id="phase-title" style="color: #ff9800;">載入中...</h2>
        <div id="my-role-info" style="font-size: 1.2em; font-weight: bold; margin-bottom: 10px; color: cyan;"></div>
        
        <div id="witch-area" class="card hidden" style="border: 2px solid #e040fb; background: #2a0a2e;">
            <h3 style="color: #e040fb; margin-top: 0;">🔮 女巫視角</h3>
            
            <div style="margin-bottom: 15px; font-size: 1.1em;">
                昨晚狼人襲擊了：
                <span id="victim-name" style="color: red; font-weight: bold; font-size: 1.3em;">(等待狼人行動...)</span>
            </div>

            <div style="display: flex; gap: 10px;">
                <button id="btn-save" onclick="usePotion('save')" 
                        style="background: #e040fb; color: white; flex: 1;">
                    💉 使用解藥
                </button>

                <button id="btn-poison" onclick="usePotion('poison')" 
                        style="background: #9c27b0; color: white; flex: 1;">
                    ☠️ 使用毒藥
                </button>
            </div>
            
            <p style="color: #ccc; font-size: 0.9em; margin-top: 10px;">
                * 毒藥請點擊按鈕後，再點擊下方的玩家頭像。
            </p>
        </div>

        <div id="guard-area" class="card hidden" style="border: 1px solid #4caf50;">
            <h4 style="color: #4caf50; margin:0 0 10px 0;">🛡️ 守衛視角</h4>
            <p>目前守護：<span id="guard-target" style="color: lightgreen; font-weight: bold;">尚未選擇</span></p>
            
            <button onclick="skipGuard()" style="background: #555; border: 1px solid #aaa;">🚫 本局空守</button>
            
            <p style="font-size: 0.8em; color: #aaa; margin-top: 10px;">(點擊頭像切換對象，不可連續守同一人)</p>
        </div>

        <div id="log-area"></div>
        <h3>玩家列表</h3>
        <div id="game-players"></div>

        <div style="margin-top: 20px; padding-top: 10px; border-top: 1px solid #555;">
            <button id="btn-end-turn" onclick="confirmTurn()" class="hidden" style="background: #ff9800; color: black;">結束我的回合</button>
            <button id="btn-start-vote" onclick="startVoting()" class="hidden" style="background: #2196f3;">發言結束 -> 開始投票</button>
            
            <button id="btn-abstain" onclick="voteAbstain()" class="hidden" style="background: #9e9e9e; color: black;">⚪ 棄票 (跳過)</button>
            
            <button id="btn-go-night" onclick="goToNight()" class="hidden" style="background: #000; border: 1px solid #666;">處決完成 -> 入夜</button>
        </div>

        <div id="ingame-host-controls" class="hidden" style="margin-top: 30px; border-top: 2px solid #d32f2f; padding-top: 10px;">
            <h4 style="color: #f44336; margin: 0 0 10px 0;">👑 房主權限</h4>
            <p style="font-size: 0.8em; color: #aaa;">如果遊戲卡住或想重新開始，請按此鈕：</p>
            <button onclick="resetGame()" style="background: #d32f2f; width: 100%;">🔄 強制結束遊戲 (重置)</button>
        </div>

        <div style="margin-top: 20px; border-top: 1px solid #666; padding-top: 15px;">
            <button onclick="leaveRoom()" style="background: #607d8b; width: 100%;">🏃 離開房間 / 切換帳號</button>
        </div>

        <div id="ingame-host-controls" class="hidden" ...> ... </div>

    </div>
</div>

<div id="custom-modal" class="modal-overlay hidden">
    <div class="modal-content">
        <h3 id="modal-title" style="color: #ff9800; margin-top: 0;">提示</h3>
        <p id="modal-message" style="font-size: 1.1em; margin: 20px 0;">訊息內容</p>
        <div class="modal-buttons">
            <button id="btn-modal-cancel" onclick="closeModal()" style="background: #666;">取消</button>
            <button id="btn-modal-confirm" style="background: #2196f3;">確定</button>
        </div>
    </div>
</div>

<div id="toast-message" class="toast hidden"></div>
<script src="/static/script.js"></script>
</body>
</html>